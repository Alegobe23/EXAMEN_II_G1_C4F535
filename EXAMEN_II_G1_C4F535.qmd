---
title: "PP"
format: html
editor: visual
---

# Portada

Universidad de Costa Rica

Escuela de Matemática

Segundo examen parcial

Prof. Luis Juárez Potoy

Estudiante: Alexandra González Bermúdez

II Semestre

2025

# Desarrollo de incisos

## Librerías

```{r}
library(readxl)
library(dplyr)
library(ggplot2)
```

1.  Cargar base de datos usando Power Query de Excel.

```{r}
base.datos <- read_excel("moras.xlsx")
View(base.datos)
```

2.  Realizar un resumen de 5 números incluyendo el promedio, para las columnas numéricas de la base de datos.

```{r}
#Resumen de la columna del salario. 
summary(base.datos$SALARIO)

#Resumen de la columna de la edad. 
summary(base.datos$EDAD)

```

3.  Realice una columna donde se identifiquen valores atípicos haciendo uso del Z-Score, de tal manera que si el valor absoluto del Z-Score es mayor a 1,96 se considera un valor atípico. Esto para la columna de salario y edad.

```{r}
#Se agrega una columna con el Z Score de la columna del salario. 
base.datos$Z.Score.Salario <- round((base.datos$SALARIO - mean(base.datos$SALARIO, na.rm = TRUE)) / sd(base.datos$SALARIO, na.rm = TRUE), 2)

#Se agrega una columna con el Z Score de la columna de la edad.
base.datos$Z.Score.Edad <- round((base.datos$EDAD - mean(base.datos$EDAD, na.rm = TRUE)) / sd(base.datos$EDAD, na.rm = TRUE), 2)

#Se agrega una columna con la clasificación del Z Score de la columna del salario.
base.datos$Categoría.Salario <- ifelse(abs(base.datos$Z.Score.Salario) > 1.96, "ATÍPICO","NORMAL")

#Se agrega una columna con la clasificación del Z Score de la columna de la edad.
base.datos$Categoría.Edad <- ifelse(abs(base.datos$Z.Score.Edad) > 1.96, "ATÍPICO","NORMAL")

View(base.datos)

```

4.  Detecte el porcentaje de valores faltantes en cada una de las columnas.

```{r}
porcentaje.NA.columnas <- data.frame(
  Columna = names(base.datos),
  Porcentaje.NA = round((colSums(is.na(base.datos)) / nrow(base.datos)) * 100, 2)
)

View(porcentaje.NA.columnas)
```

5.  Imputar los valores faltantes haciendo uso de algún método.

```{r}
#Para imputar los valores en las columnas de edad y salario, se utiliza el promedio respectivo de cada columna. En el caso de la columna del tipo de aseguramiento, se emplea la moda. 

#Procedemos a imputar la columna del salario. 

base.datos$SALARIO[is.na(base.datos$SALARIO)] <- 657534

#Procedemos a imputar la columna de la edad. 
base.datos$EDAD[is.na(base.datos$EDAD)] <- 41.91

#Para ver qué elemento se repite más en la columna del tipo de aseguramiento. 
table(base.datos$TIPO_ASEGURAMIENTO)

#Procedemos a imputar la columna de la edad. 
base.datos$TIPO_ASEGURAMIENTO[is.na(base.datos$TIPO_ASEGURAMIENTO)] <- "ASALARIADO"

View(base.datos)

```

7.  Realizar gráficos donde se vea la cantidad de individuos por cada categoría. Analizar los resultados.

Gráfico de la categoría de sexo

```{r}
ggplot(base.datos, aes(x = SEXO)) +
  geom_bar(fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Sexo del asegurado", y = "Cantidad", 
       title = "Cantidad de asegurados por sexo")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Cantidad_asegurados_sexo.png", width = 8, height = 6, dpi = 900)
```

Gráfico de la categoría de sector

```{r}
ggplot(base.datos, aes(x = SECTOR)) +
  geom_bar(fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Sector", y = "Cantidad", 
       title = "Cantidad de asegurados por sector")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Cantidad_asegurados_sector.png", width = 8, height = 6, dpi = 900)
```

Gráfico de la categoría del tipo de aseguramiento

```{r}
ggplot(base.datos, aes(x = "", fill = TIPO_ASEGURAMIENTO)) +
  geom_bar(width= 0.5) +
  coord_polar(theta = "y") +
  theme_void() + 
  geom_text(stat = "count", aes(label = after_stat(count)), 
            position = position_stack(vjust = 0.5)) +
  labs(title = "Cantidad de asegurados por tipo de aseguramiento",
        fill = "Tipo de aseguramiento")


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Cantidad_asegurados_aseguramiento.png", width = 8, height = 6, dpi = 900)
```

Gráfico de la categoría del estado de actividad del seguro

```{r}
ggplot(base.datos, aes(x = INDICADOR_ACTIVO)) +
  geom_bar(fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Estado de actividad del seguro: SI (activo); NO (inactivo)", y = "Cantidad", 
       title = "Cantidad de asegurados por estado de actividad")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Cantidad_asegurados_estado_actividad.png", width = 8, height = 6, dpi = 900)
```

Gráfico de la categoría de la procedencia

```{r}
ggplot(base.datos, aes(x = INDICADOR.EXTRANJERO)) +
  geom_bar(fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Indicador de extranjería: SI (extranjero); NO (nacional)", y = "Cantidad", 
       title = "Cantidad de asegurados por procedencia")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Cantidad_asegurados_procedencia.png", width = 8, height = 6, dpi = 900)
```

Gráfico de la categoría de la morosidad

```{r}
ggplot(base.datos, aes(x = INDICADOR_MOROSO)) +
  geom_bar(fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Indicador de morosidad: SI (moroso); NO (no moroso)", y = "Cantidad", 
       title = "Cantidad de asegurados por estado de morosidad")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Cantidad_asegurados_morosidad.png", width = 8, height = 6, dpi = 900)
```

**Nota**: aplica el mismo análisis efectuado en el Excel, ya que los datos no han cambiado.

7.  Realizar un gráfico para cada una de las variables categóricas en donde se vea el porcentaje de personas morosas por cada clase. Analizar los resultados.

Categoría del sexo

```{r}
datos.sexo <- base.datos %>% 
  filter(INDICADOR_MOROSO == "SI") %>% 
  group_by(SEXO) %>% 
  summarise(
    Porcentaje.morosos = (n()/nrow(base.datos)) * 100
  )
#View(datos.sexo)

ggplot(datos.sexo, aes(x = SEXO, y = Porcentaje.morosos)) +
  geom_bar(stat = "identity", fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Sexo", y = "Porcentaje", 
       title = "Porcentaje de morosidad por sexo")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(aes(label = Porcentaje.morosos), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Porcentaje_morosidad_sexo.png", width = 8, height = 6, dpi = 900)
```

Categoría de sector

```{r}
datos.sector <- base.datos %>% 
  filter(INDICADOR_MOROSO == "SI") %>% 
  group_by(SECTOR) %>% 
  summarise(
    Porcentaje.morosos = (n()/nrow(base.datos)) * 100
  )

ggplot(datos.sector, aes(x = SECTOR, y = Porcentaje.morosos)) +
  geom_bar(stat = "identity", fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Sector", y = "Porcentaje", 
       title = "Porcentaje de morosidad por sector")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(aes(label = Porcentaje.morosos), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Porcentaje_morosidad_sector.png", width = 8, height = 6, dpi = 900)
```

Categoría de procedencia

```{r}
datos.procedencia <- base.datos %>% 
  filter(INDICADOR_MOROSO == "SI") %>% 
  group_by(INDICADOR.EXTRANJERO) %>% 
  summarise(
    Porcentaje.morosos = (n()/nrow(base.datos)) * 100
  )

ggplot(datos.procedencia, aes(x = INDICADOR.EXTRANJERO, y = Porcentaje.morosos)) +
  geom_bar(stat = "identity", fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Indicador de extranjería: SI (extranjero); NO (nacional)", y = "Porcentaje", 
       title = "Porcentaje de morosidad por procedencia")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(aes(label = Porcentaje.morosos), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Porcentaje_morosidad_procedencia.png", width = 8, height = 6, dpi = 900)
```

Categoría de actividad del seguro

```{r}
datos.actividad <- base.datos %>% 
  filter(INDICADOR_MOROSO == "SI") %>% 
  group_by(INDICADOR_ACTIVO) %>% 
  summarise(
    Porcentaje.morosos = (n()/nrow(base.datos)) * 100
  )

ggplot(datos.actividad, aes(x = INDICADOR_ACTIVO, y = Porcentaje.morosos)) +
  geom_bar(stat = "identity", fill = "pink", width = 0.5)+
  theme_minimal()+
  labs(x = "Indicador de actividad: SI (activo); NO (inactivo)", y = "Porcentaje", 
       title = "Porcentaje de morosidad por actividad del seguro")+
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(margin = margin(r = 15)),
        axis.title.x = element_text(margin = margin(t = 15)))+
  geom_text(aes(label = Porcentaje.morosos), 
            vjust = -0.1, color = "deeppink", size = 4, fontface = "bold") 


ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Porcentaje_morosidad_actividad.png", width = 8, height = 6, dpi = 900)
```

Categoría del tipo de aseguramiento

```{r}
datos.aseguramiento <- base.datos %>% 
  filter(INDICADOR_MOROSO == "SI") %>% 
  group_by(TIPO_ASEGURAMIENTO) %>% 
  summarise(
    Porcentaje.morosos = (n()/nrow(base.datos)) * 100
  )

ggplot(datos.aseguramiento, aes(x = "", y = Porcentaje.morosos, fill = TIPO_ASEGURAMIENTO)) +
  geom_bar(width = 0.5, stat = "identity") +
  coord_polar(theta = "y") +
  theme_void() +
  geom_text(aes(label = paste0(round(Porcentaje.morosos, 1), "%")),
    angle = 45, 
    size = 3,
    fontface = "bold",
    position = position_stack(vjust = 0.5)) +
  labs(title = "Porcentaje de morosidad por tipo de aseguramiento",
    fill = "Tipo de aseguramiento")

ggsave("C:/Users/alego/OneDrive/Documentos/EXAMEN_II_G1_C4F535_R/EXAMEN_II_G1_C4F535/res/Porcentaje_morosidad_aseguramiento.png", width = 8, height = 6, dpi = 900)
```

**Nota**: aplica el mismo análisis efectuado en el Excel, ya que los datos no han cambiado.
